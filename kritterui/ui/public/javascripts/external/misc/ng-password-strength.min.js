"use strict";angular.module("ngPasswordStrength",["ui.bootstrap.progressbar","template/progressbar/progress.html","template/progressbar/progressbar.html"]).directive("ngPasswordStrength",function(){return{template:'<progressbar value="value" type="{{class}}">{{value}}%</progressbar>',restrict:"A",scope:{pwd:"=ngPasswordStrength"},link:function(a){var b=function(a){var b,c,d,e,f={pos:{},neg:{}},g={pos:{},neg:{seqLetter:0,seqNumber:0,seqSymbol:0}},h=0,i="abcdefghijklmnopqrstuvwxyz",j="01234567890",k="\\!@#$%&/()=?Â¿";if(a){for(f.pos.lower=a.match(/[a-z]/g),f.pos.upper=a.match(/[A-Z]/g),f.pos.numbers=a.match(/\d/g),f.pos.symbols=a.match(/[$-/:-?{-~!^_`\[\]]/g),f.pos.middleNumber=a.slice(1,-1).match(/\d/g),f.pos.middleSymbol=a.slice(1,-1).match(/[$-/:-?{-~!^_`\[\]]/g),g.pos.lower=f.pos.lower?f.pos.lower.length:0,g.pos.upper=f.pos.upper?f.pos.upper.length:0,g.pos.numbers=f.pos.numbers?f.pos.numbers.length:0,g.pos.symbols=f.pos.symbols?f.pos.symbols.length:0,b=_.reduce(g.pos,function(a,b){return a+Math.min(1,b)},0),g.pos.numChars=a.length,b+=g.pos.numChars>=8?1:0,g.pos.requirements=b>=3?b:0,g.pos.middleNumber=f.pos.middleNumber?f.pos.middleNumber.length:0,g.pos.middleSymbol=f.pos.middleSymbol?f.pos.middleSymbol.length:0,f.neg.consecLower=a.match(/(?=([a-z]{2}))/g),f.neg.consecUpper=a.match(/(?=([A-Z]{2}))/g),f.neg.consecNumbers=a.match(/(?=(\d{2}))/g),f.neg.onlyNumbers=a.match(/^[0-9]*$/g),f.neg.onlyLetters=a.match(/^([a-z]|[A-Z])*$/g),g.neg.consecLower=f.neg.consecLower?f.neg.consecLower.length:0,g.neg.consecUpper=f.neg.consecUpper?f.neg.consecUpper.length:0,g.neg.consecNumbers=f.neg.consecNumbers?f.neg.consecNumbers.length:0,e=0;e<i.length-2;e++){var l=a.toLowerCase();d=i.substring(e,parseInt(e+3)),c=_.str.reverse(d),(-1!==l.indexOf(d)||-1!==l.indexOf(c))&&g.neg.seqLetter++}for(e=0;e<j.length-2;e++)d=j.substring(e,parseInt(e+3)),c=_.str.reverse(d),(-1!==a.indexOf(d)||-1!==a.toLowerCase().indexOf(c))&&g.neg.seqNumber++;for(e=0;e<k.length-2;e++)d=k.substring(e,parseInt(e+3)),c=_.str.reverse(d),(-1!==a.indexOf(d)||-1!==a.toLowerCase().indexOf(c))&&g.neg.seqSymbol++;g.neg.repeated=_.chain(a.toLowerCase().split("")).countBy(function(a){return a}).reject(function(a){return 1===a}).reduce(function(a,b){return a+b},0).value(),h+=4*g.pos.numChars,g.pos.upper&&(h+=2*(g.pos.numChars-g.pos.upper)),g.pos.lower&&(h+=2*(g.pos.numChars-g.pos.lower)),(g.pos.upper||g.pos.lower)&&(h+=4*g.pos.numbers),h+=6*g.pos.symbols,h+=2*(g.pos.middleSymbol+g.pos.middleNumber),h+=2*g.pos.requirements,h-=2*g.neg.consecLower,h-=2*g.neg.consecUpper,h-=2*g.neg.consecNumbers,h-=3*g.neg.seqNumber,h-=3*g.neg.seqLetter,h-=3*g.neg.seqSymbol,f.neg.onlyNumbers&&(h-=g.pos.numChars),f.neg.onlyLetters&&(h-=g.pos.numChars),g.neg.repeated&&(h-=g.neg.repeated/g.pos.numChars*10)}return Math.max(0,Math.min(100,Math.round(h)))},c=function(a){switch(Math.round(a/33)){case 0:case 1:return"danger";case 2:return"warning";case 3:return"success"}};a.$watch("pwd",function(){a.value=b(a.pwd),a.class=c(a.value)})}}});